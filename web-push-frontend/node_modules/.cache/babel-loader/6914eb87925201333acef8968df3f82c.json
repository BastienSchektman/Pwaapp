{"ast":null,"code":"var _jsxFileName = \"/Users/bastienschektman/Downloads/reactFront&BackavecSW 2/web-push-frontend/src/subscription.js\";\nimport { toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst convertedVapidKey = urlBase64ToUint8Array(process.env.REACT_APP_PUBLIC_VAPID_KEY);\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = \"=\".repeat((4 - base64String.length % 4) % 4);\n  // eslint-disable-next-line\n  const base64 = (base64String + padding).replace(/\\-/g, \"+\").replace(/_/g, \"/\");\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\nfunction sendSubscription(subscription) {\n  const apiUrl = process.env.REACT_APP_API_URL || 'http://localhost:9000';\n  return fetch(`${apiUrl}/notifications/subscribe`, {\n    method: 'POST',\n    body: JSON.stringify(subscription),\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n}\nexport function subscribeUser() {\n  if ('serviceWorker' in navigator) {\n    // Configuration de l'écouteur d'événements pour les notifications\n    navigator.serviceWorker.addEventListener('message', event => {\n      if (event.data && event.data.type === 'monevenementcustom') {\n        const notificationData = event.data.payload;\n\n        // Afficher un toast avec les données de notification\n        toast(/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [notificationData.title && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontWeight: 'bold'\n            },\n            children: notificationData.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 41,\n            columnNumber: 40\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: notificationData.body\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 42,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 40,\n          columnNumber: 11\n        }, this), {\n          position: \"top-right\",\n          autoClose: 5000,\n          hideProgressBar: false,\n          closeOnClick: true,\n          pauseOnHover: true,\n          draggable: true\n        });\n        console.log('Received notification data:', notificationData);\n      }\n    });\n    navigator.serviceWorker.ready.then(function (registration) {\n      if (!registration.pushManager) {\n        console.log('Push manager unavailable.');\n        return;\n      }\n      registration.pushManager.getSubscription().then(function (existedSubscription) {\n        if (existedSubscription === null) {\n          console.log('No subscription detected, make a request.');\n          registration.pushManager.subscribe({\n            applicationServerKey: convertedVapidKey,\n            userVisibleOnly: true\n          }).then(function (newSubscription) {\n            console.log('New subscription added.', newSubscription);\n            sendSubscription(newSubscription);\n            // Afficher un toast pour indiquer l'abonnement réussi\n            toast.success('Notifications activées avec succès!', {\n              position: \"top-right\",\n              autoClose: 3000\n            });\n          }).catch(function (e) {\n            if (Notification.permission !== 'granted') {\n              console.log('Permission was not granted.');\n              // Afficher un toast pour indiquer que la permission n'a pas été accordée\n              toast.error('Permission de notification refusée', {\n                position: \"top-right\",\n                autoClose: 5000\n              });\n            } else {\n              console.error('An error ocurred during the subscription process.', e);\n              // Afficher un toast pour indiquer une erreur\n              toast.error('Une erreur est survenue lors de l\\'activation des notifications', {\n                position: \"top-right\",\n                autoClose: 5000\n              });\n            }\n          });\n        } else {\n          console.log('Existed subscription detected.');\n          sendSubscription(existedSubscription);\n        }\n      });\n    }).catch(function (e) {\n      console.error('An error ocurred during Service Worker registration.', e);\n      // Afficher un toast pour indiquer une erreur d'enregistrement du service worker\n      toast.error('Erreur lors de l\\'enregistrement du service worker', {\n        position: \"top-right\",\n        autoClose: 5000\n      });\n    });\n  }\n}","map":{"version":3,"names":["toast","jsxDEV","_jsxDEV","convertedVapidKey","urlBase64ToUint8Array","process","env","REACT_APP_PUBLIC_VAPID_KEY","base64String","padding","repeat","length","base64","replace","rawData","window","atob","outputArray","Uint8Array","i","charCodeAt","sendSubscription","subscription","apiUrl","REACT_APP_API_URL","fetch","method","body","JSON","stringify","headers","subscribeUser","navigator","serviceWorker","addEventListener","event","data","type","notificationData","payload","children","title","style","fontWeight","fileName","_jsxFileName","lineNumber","columnNumber","position","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","console","log","ready","then","registration","pushManager","getSubscription","existedSubscription","subscribe","applicationServerKey","userVisibleOnly","newSubscription","success","catch","e","Notification","permission","error"],"sources":["/Users/bastienschektman/Downloads/reactFront&BackavecSW 2/web-push-frontend/src/subscription.js"],"sourcesContent":["import { toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\n\nconst convertedVapidKey = urlBase64ToUint8Array(process.env.REACT_APP_PUBLIC_VAPID_KEY)\n\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = \"=\".repeat((4 - base64String.length % 4) % 4)\n  // eslint-disable-next-line\n  const base64 = (base64String + padding).replace(/\\-/g, \"+\").replace(/_/g, \"/\")\n\n  const rawData = window.atob(base64)\n  const outputArray = new Uint8Array(rawData.length)\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i)\n  }\n  return outputArray\n}\n\nfunction sendSubscription(subscription) {\n  const apiUrl = process.env.REACT_APP_API_URL || 'http://localhost:9000';\n  return fetch(`${apiUrl}/notifications/subscribe`, {\n    method: 'POST',\n    body: JSON.stringify(subscription),\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n}\n\nexport function subscribeUser() {\n  if ('serviceWorker' in navigator) {\n    // Configuration de l'écouteur d'événements pour les notifications\n    navigator.serviceWorker.addEventListener('message', event => {\n      if (event.data && event.data.type === 'monevenementcustom') {\n        const notificationData = event.data.payload;\n\n        // Afficher un toast avec les données de notification\n        toast(\n          <div>\n            {notificationData.title && <div style={{ fontWeight: 'bold' }}>{notificationData.title}</div>}\n            <div>{notificationData.body}</div>\n          </div>,\n          { \n            position: \"top-right\",\n            autoClose: 5000,\n            hideProgressBar: false,\n            closeOnClick: true,\n            pauseOnHover: true,\n            draggable: true\n          }\n        );\n\n        console.log('Received notification data:', notificationData);\n      }\n    });\n\n    navigator.serviceWorker.ready.then(function(registration) {\n      if (!registration.pushManager) {\n        console.log('Push manager unavailable.')\n        return\n      }\n\n      registration.pushManager.getSubscription().then(function(existedSubscription) {\n        if (existedSubscription === null) {\n          console.log('No subscription detected, make a request.')\n          registration.pushManager.subscribe({\n            applicationServerKey: convertedVapidKey,\n            userVisibleOnly: true,\n          }).then(function(newSubscription) {\n            console.log('New subscription added.', newSubscription)\n            sendSubscription(newSubscription)\n            // Afficher un toast pour indiquer l'abonnement réussi\n            toast.success('Notifications activées avec succès!', {\n              position: \"top-right\",\n              autoClose: 3000\n            });\n          }).catch(function(e) {\n            if (Notification.permission !== 'granted') {\n              console.log('Permission was not granted.')\n              // Afficher un toast pour indiquer que la permission n'a pas été accordée\n              toast.error('Permission de notification refusée', {\n                position: \"top-right\",\n                autoClose: 5000\n              });\n            } else {\n              console.error('An error ocurred during the subscription process.', e)\n              // Afficher un toast pour indiquer une erreur\n              toast.error('Une erreur est survenue lors de l\\'activation des notifications', {\n                position: \"top-right\",\n                autoClose: 5000\n              });\n            }\n          })\n        } else {\n          console.log('Existed subscription detected.')\n          sendSubscription(existedSubscription)\n        }\n      })\n    })\n    .catch(function(e) {\n      console.error('An error ocurred during Service Worker registration.', e)\n      // Afficher un toast pour indiquer une erreur d'enregistrement du service worker\n      toast.error('Erreur lors de l\\'enregistrement du service worker', {\n        position: \"top-right\",\n        autoClose: 5000\n      });\n    })\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}